<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Chat</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.5.1/peerjs.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: #000; color: white; }
        .container { width: 100%; height: 100vh; position: relative; }
        
        .video-container { 
            width: 100%;
            height: 100vh;
            position: relative;
            background: #000;
        }
        
        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            background: #000;
        }

        .self-view {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 100px;
            height: 150px;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            z-index: 1001;
            display: none;
        }

        .show-self {
            display: block;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 1002;
            padding: 10px;
            background: rgba(0,0,0,0.5);
            border-radius: 20px;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn.active {
            background: #4CAF50;
        }

        .status {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            border-radius: 20px;
            z-index: 1002;
        }

        .setup-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1002;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .setup-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
        }

        .setup-btn:hover {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const App = () => {
            const [isHost, setIsHost] = React.useState(false);
            const [status, setStatus] = React.useState('');
            const [isConnected, setIsConnected] = React.useState(false);
            const [useCamera, setUseCamera] = React.useState(false);
            const [showSelfView, setShowSelfView] = React.useState(true);
            const [isFullscreen, setIsFullscreen] = React.useState(false);

            const localVideoRef = React.useRef();
            const remoteVideoRef = React.useRef();
            const peerRef = React.useRef(null);
            const streamRef = React.useRef(null);

            // Previous connection logic remains the same...
            // (Include all the setupHost, setupViewer, and connection logic from the previous version)

            const toggleFullscreen = () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                    setIsFullscreen(true);
                } else {
                    document.exitFullscreen();
                    setIsFullscreen(false);
                }
            };

            const toggleSelfView = () => {
                setShowSelfView(!showSelfView);
            };

            return (
                <div className="container">
                    <div className="status">{status}</div>

                    <div className="setup-controls">
                        <button 
                            className="setup-btn"
                            onClick={() => setIsHost(!isHost)}
                        >
                            {isHost ? 'Switch to Viewer' : 'Switch to Host'}
                        </button>
                        
                        {!isHost && (
                            <>
                                <button 
                                    className="setup-btn"
                                    onClick={() => setUseCamera(!useCamera)}
                                >
                                    {useCamera ? 'Disable Camera' : 'Enable Camera'}
                                </button>
                                {!isConnected && (
                                    <button 
                                        className="setup-btn"
                                        onClick={connectToHost}
                                    >
                                        Connect to Host
                                    </button>
                                )}
                            </>
                        )}
                    </div>

                    {/* Main Video Display */}
                    <div className={`video-container ${isFullscreen ? 'fullscreen' : ''}`}>
                        {isHost ? (
                            <video
                                ref={localVideoRef}
                                autoPlay
                                playsInline
                                muted
                            />
                        ) : (
                            <video
                                ref={remoteVideoRef}
                                autoPlay
                                playsInline
                            />
                        )}
                    </div>

                    {/* Self View (Picture in Picture) */}
                    {useCamera && !isHost && (
                        <div className={`self-view ${showSelfView ? 'show-self' : ''}`}>
                            <video
                                ref={localVideoRef}
                                autoPlay
                                playsInline
                                muted
                            />
                        </div>
                    )}

                    {/* Control Bar */}
                    <div className="controls">
                        <button 
                            className="control-btn"
                            onClick={toggleFullscreen}
                        >
                            {isFullscreen ? 'â¤“' : 'â¤¢'}
                        </button>
                        
                        {useCamera && !isHost && (
                            <button 
                                className={`control-btn ${showSelfView ? 'active' : ''}`}
                                onClick={toggleSelfView}
                            >
                                ðŸ‘¤
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        // Handle fullscreen changes
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) {
                setIsFullscreen(false);
            }
        });

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
