<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Video Chat</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.5.1/peerjs.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto;
            background: #0f0f1a;
            color: white;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
        }
        .host-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
        }
        .host-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #2a2a3a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .host-details h2 {
            margin: 0;
            color: #fff;
        }
        .host-details p {
            margin: 5px 0;
            color: #aaa;
        }
        .video-container { 
            background: #1a1a2a;
            border-radius: 12px;
            aspect-ratio: 16/9;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .video-container.host {
            width: 100%;
        }
        .video-container.viewer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        .control-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .control-btn:hover { 
            background: rgba(255,255,255,0.2);
        }
        .control-btn.off { 
            background: #dc3545;
        }
        .payment-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        .rate-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }
        .rate {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }
        .timer {
            font-size: 20px;
            color: #fff;
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        .tip-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        .tip-btn {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .tip-btn:hover {
            transform: translateY(-2px);
            background: #45a049;
        }
        .status {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            border-radius: 20px;
            z-index: 1000;
        }
        .connect-btn {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }
        .connect-btn:hover {
            background: #45a049;
        }
        .connect-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        // Simulated host data (in a real app, this would come from a backend)
        const HOST_DATA = {
            id: 'host123',
            name: 'Sarah',
            avatar: 'ðŸ‘©',
            rate: 2.99,
            status: 'Available',
            description: 'Professional streamer | 2+ years experience',
        };

        const App = () => {
            const [isHost, setIsHost] = React.useState(false);
            const [isConnected, setIsConnected] = React.useState(false);
            const [peer, setPeer] = React.useState(null);
            const [status, setStatus] = React.useState('');
            const [isMuted, setIsMuted] = React.useState(false);
            const [isVideoOff, setIsVideoOff] = React.useState(false);
            const [elapsedTime, setElapsedTime] = React.useState(0);
            const [remoteStream, setRemoteStream] = React.useState(null);

            const localVideoRef = React.useRef();
            const remoteVideoRef = React.useRef();
            const timerRef = React.useRef();

            // Initialize media stream
            React.useEffect(() => {
                async function setupMedia() {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({
                            video: true,
                            audio: true
                        });
                        localVideoRef.current.srcObject = stream;

                        // Initialize PeerJS
                        const newPeer = new Peer();
                        
                        newPeer.on('open', (id) => {
                            setPeer(newPeer);
                            // If you're the host, use the predefined host ID
                            if (isHost) {
                                console.log('Host ID:', HOST_DATA.id);
                            }
                        });

                        newPeer.on('call', (call) => {
                            call.answer(stream);
                            call.on('stream', (remoteStream) => {
                                setRemoteStream(remoteStream);
                                remoteVideoRef.current.srcObject = remoteStream;
                                setIsConnected(true);
                                startTimer();
                            });
                        });

                    } catch (err) {
                        showStatus('Error accessing camera/microphone');
                    }
                }
                setupMedia();
            }, [isHost]);

            const showStatus = (message) => {
                setStatus(message);
                setTimeout(() => setStatus(''), 3000);
            };

            const connectToHost = () => {
                if (!peer) return;

                navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                    .then(stream => {
                        const call = peer.call(HOST_DATA.id, stream);
                        call.on('stream', (remoteStream) => {
                            setRemoteStream(remoteStream);
                            remoteVideoRef.current.srcObject = remoteStream;
                            setIsConnected(true);
                            startTimer();
                        });
                    });
            };

            const startTimer = () => {
                timerRef.current = setInterval(() => {
                    setElapsedTime(prev => prev + 1);
                }, 1000);
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const calculateCost = () => {
                const minutes = Math.ceil(elapsedTime / 60);
                return (minutes * HOST_DATA.rate).toFixed(2);
            };

            const toggleMute = () => {
                const audioTrack = localVideoRef.current.srcObject.getAudioTracks()[0];
                audioTrack.enabled = !audioTrack.enabled;
                setIsMuted(!audioTrack.enabled);
            };

            const toggleVideo = () => {
                const videoTrack = localVideoRef.current.srcObject.getVideoTracks()[0];
                videoTrack.enabled = !videoTrack.enabled;
                setIsVideoOff(!videoTrack.enabled);
            };

            const handleTip = (amount) => {
                showStatus(`Tip of $${amount} sent!`);
            };

            return (
                <div className="container">
                    {status && <div className="status">{status}</div>}

                    <div className="header">
                        <h1>{isHost ? 'Host Dashboard' : 'Private Video Chat'}</h1>
                    </div>

                    {!isHost && (
                        <div className="host-info">
                            <div className="host-avatar">{HOST_DATA.avatar}</div>
                            <div className="host-details">
                                <h2>{HOST_DATA.name}</h2>
                                <p>{HOST_DATA.description}</p>
                                <p>Status: {HOST_DATA.status}</p>
                            </div>
                        </div>
                    )}

                    <div className={`video-container ${isHost ? 'host' : 'viewer'}`}>
                        <video
                            ref={localVideoRef}
                            autoPlay
                            playsInline
                            muted
                        />
                        <div className="controls">
                            <button 
                                className={`control-btn ${isMuted ? 'off' : ''}`}
                                onClick={toggleMute}
                            >
                                {isMuted ? 'ðŸ”‡' : 'ðŸŽ¤'}
                            </button>
                            <button 
                                className={`control-btn ${isVideoOff ? 'off' : ''}`}
                                onClick={toggleVideo}
                            >
                                {isVideoOff ? 'ðŸ“µ' : 'ðŸ“¹'}
                            </button>
                        </div>
                    </div>

                    {remoteStream && (
                        <div className={`video-container ${!isHost ? 'host' : 'viewer'}`}>
                            <video
                                ref={remoteVideoRef}
                                autoPlay
                                playsInline
                            />
                        </div>
                    )}

                    {!isHost && !isConnected && (
                        <button 
                            className="connect-btn"
                            onClick={connectToHost}
                            disabled={!peer}
                        >
                            Connect with {HOST_DATA.name} (${HOST_DATA.rate}/min)
                        </button>
                    )}

                    {isConnected && !isHost && (
                        <div className="payment-section">
                            <div className="rate-info">
                                <div className="rate">
                                    ${HOST_DATA.rate}/min
                                </div>
                                <div className="timer">
                                    Time: {formatTime(elapsedTime)}
                                </div>
                                <div className="cost">
                                    Total: ${calculateCost()}
                                </div>
                            </div>

                            <div className="tip-buttons">
                                {[5, 10, 20, 50].map(amount => (
                                    <button 
                                        key={amount}
                                        className="tip-btn"
                                        onClick={() => handleTip(amount)}
                                    >
                                        Tip ${amount}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
